
(defmodule App.Example
  (alias App.Example.Types
         App.ErrorChecker)  

  (defn parse 
    ([string] (Types.Result integer Types.Errors))
     [input]  (let [error_fn (ErrorChecker.unfortunate_error_checker "13") 
                    lucky_string "42"
                    a %{1 2 3 4}
                    lucky_number 42] 
                (case input
                  ((^ lucky_string) {:ok lucky_number})
                  (other {:error (error_fn input)}))))
                  
  (defn match_map
    ([string] (| 1 2))
     ;; [input]  (let [ m (: %{1 2 3 integer} %{1 2 3 4})] 
     [input]  (let [ m  %{1 2 3 4}] 
                (case m
                  (%{1 a} a)
                  (other 1))))
)

(defmodule App.ErrorChecker
  (defn unfortunate_error_checker 
      ([string] (fn [string] (| :other_error :unfortunate_error)))
      [unlucky_string] 
        (fn [str]
          (if (= str unlucky_string) 
                              :unfortunate_error 
                              :other_error))))

(defmodule App.Example.Types
  (alias App.Example.Types)
  (deftype Result  
    (forall [a b] 
      (| {:ok a}
         {:error b})))
  (deftype Errors (| :unfortunate_error 
                     :other_error 
                     :yet_another_error )))



